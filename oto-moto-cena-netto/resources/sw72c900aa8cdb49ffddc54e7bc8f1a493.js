function inViewport(el){var viewport={top:$(window).scrollTop()},bounds=$(el).offset();viewport.bottom=viewport.top+$(window).height();bounds.bottom=bounds.top+$(el).outerHeight();return(!(viewport.bottom<bounds.top||viewport.top>bounds.bottom))};AdsClass=BaseClass.extend({init:function(){this.submitTimer=null;this.initDom();this.initAnalyticsEvents();this.initPageLoader();this.init404();this.initGptStickyClose();this.initOrder();this.initPrevNext();this.initFavoritesGalleryBox();this.initAdsense(false);this.initCategories();this.initPopState();this.initFacets(this.dom.form);this.initPager();this.initViewButtons();this.initCurrencyButtons();this.initTopLinks();this.initSubmit();this.initSearchOptions();this.setSearchParams();this.initFilters();this.initTabs();this.initAfterAdsLoad(true);this.initFiltersDialog();this.initContactLayer(this);this.startContactFormValidator($('.quick-contact-form'));this.initMultiShowNumber();this.setFavoriteButtonTrackingKey();this.initHideBottomBanners();this.initMegaAdSlotHandler();this.initAtiTracking();this.trackListing();this.initAdsEvents();this.initSatiTracking();this.initOnboardingFlowControl();this.initGetLogEventsOnFavorites();this.initAdEvents();this.initPreviewAd()},initAfterAdsLoad:function(initial){this.initClickReport();this.initStickyAdSlotHalfPage();this.startContactFormValidator($('.quick-contact-form'));if(!initial){ObserveObject.bindClicks();setTimeout(function(){ObserveObject.listReloaded();ObserveObject.updateList()},100)}},initDom:function(){this.dom={body:$('body'),form:$('#mainTopSearch'),adsContainer:$('#listContainer'),headerContainer:$('#header-container'),bodyContainer:$('#body-container'),params:$('#paramsList'),categoryHidden:$('#searchFormCatID'),categoryList:$('ul#categorySelectList'),searchList:$('#searchList'),regionInput:$('#cityField'),distanceSelect:$('#distanceSelect'),filterItems:$('#paramsList .filter-item').add('.filterGroups .filter-item'),featuredAds:$('.offer-item.promoted'),ad:$('a[data-ad-id]')}},initAnalyticsEvents:function(){if(this.dom.featuredAds.length){var event="listing_with_featured_ads_";event+=this.isMobile()?"m":"d";dataLayer.push({event:event})};var instance=this;this.dom.ad.on('click',function(ev){var clickedElement=$(this),clickedElementIsPromoted=$(this).closest('article').hasClass('promoted'),clickedElementHasBrandProgramName=$(this).data('ad-bp-name'),googleAnalyticsEvent='',ATInternetActionType='';if(clickedElementIsPromoted){googleAnalyticsEvent="featured_list_item_clicked_";ATInternetActionType="featured_list_item"}else{googleAnalyticsEvent="list_item_clicked_";ATInternetActionType="list_item"};googleAnalyticsEvent+=instance.isMobile()?"m":"d";dataLayer.push({event:googleAnalyticsEvent});var ATInternetEvent=xtcustom||{};ATInternetEvent.ad_id=clickedElement.data('adId');ATInternetEvent.action_type=ATInternetActionType;xt_med('C','','listing&stc='+JSON.stringify(ATInternetEvent),'A');if(typeof clickedElementHasBrandProgramName!=="undefined"){xt_adc(this,'PUB-['+clickedElementHasBrandProgramName+']-[Listing]')}else xt_adc(this,'PUB-[GLOBAL]-[Listing]')})},initPageLoader:function(){this.Pageloader=$('<div class="pageloader" id="loader"><div></div></div>').hide().appendTo(this.dom.form)},init404:function(){if(window.location.href.indexOf('#from404')>0)$('#topmessages').append($('#ad-not-available-box').show())},initOrder:function(){var thiz=this;$('#order-select-gallery').on("change",function(){var $this=$(this),$hidden=$('input[name="search[order]"]',thiz.dom.form);if(!$hidden.length)$hidden=$('<input type="hidden" name="search[order]" />').appendTo(thiz.dom.form);var $optionSelected=$this.find('option:selected');if($optionSelected.length){$hidden.val($optionSelected.data('type'))}else $hidden.remove();thiz.submitForm();return true});if(typeof $.fn.renderForms=='function')$select.parent().renderForms()},initPrevNext:function(){var thiz=this;if(window.searchID!=undefined&&window.searchID!='')$('a.linkWithHash',thiz.dom.adsContainer).each(function(){var $this=$(this),hash='#'+window.searchID;if($this.hasClass('linkWithHashPromoted'))hash+=';promoted';if($.browser.webkit&&!$this.hasClass('thumb'))$this.addClass('refreshWebkit');$this.attr('href',$this.attr('href')+hash)});if(window.location.hash.substring(1).indexOf('ad_id=')>=0){var ad_id=window.location.hash.substring(1).replace('ad_id=',''),$ad=$('.ad_id'+ad_id+':first');if($ad.length>0)$('html, body').animate({scrollTop:$ad.offset().top},100)}},initCategories:function(){var thiz=this;$('select#searchFormCatID').select2({language:window.lang,placeholder:{id:$select.find('option').first().val(),text:$select.find('option').first().text()},allowClear:true,theme:"customSelect custom-select-single",useNativeSelect:thiz.isMobile()}).change(function(){thiz.dom.form.attr('action',thiz.dom.form.attr('action').replace('#listContainer','#form'));if($('select#searchFormCatID').val()===null)$('select#searchFormCatID').val($('#searchFormRootCatID').val());thiz.dom.form.trigger(jQuery.Event('submit',{forceNoAjax:true}));return false})},showPageLoader:function(percentage,time,callback){var thiz=this;callback=callback==undefined?function(){}:callback;this.Pageloader.show().find('div').animate({width:percentage+'%'},time,callback);var $listContainer=thiz.dom.adsContainer,$headerContainer=thiz.dom.headerContainer;if($listContainer.length>0){var ListLoaderPositionTop=$listContainer[0].getBoundingClientRect().top,HeaderContainerHeight=$headerContainer.height();this.ListOverlay=$('<div class="listOverlay"><div><div class="loader"></div>Ładowanie...</div></div>');this.ListOverlay.find('> div').css({top:(ListLoaderPositionTop<=HeaderContainerHeight?HeaderContainerHeight:ListLoaderPositionTop)+70});this.ListOverlay.appendTo($listContainer)}},hidePageLoader:function(percentage){var thiz=this;this.Pageloader.fadeOut(400,function(){thiz.Pageloader.find('div').css('width','0px')});this.ListOverlay.remove()},stopPageLoader:function(percentage){this.Pageloader.find('div').stop();this.ListOverlay.remove()},getSearchRanges:function(key){var catID=window.category_id?window.category_id:0;for(var x in window.searchRanges){var ranges=window.searchRanges[x];if(ranges.k[key]&&ranges.c[catID]){var rangeKey='v',label=ranges.s[key];if((key=='price')||(key=='salary')){var currencySymbol=this.getCurrentCurrency();if(ranges['v_'+currencySymbol.code])rangeKey='v_'+currencySymbol.code;if(currencySymbol.symbol)label=currencySymbol.symbol};var values=ranges[rangeKey].split(',');return{values:values.map(function(v){return parseInt(v.replace(/ /g,''))}),label:label}}}},getCurrentCurrency:function(){var currencySymbol=window.defaultCurrency;if(currencySymbol in window.currencies&&"symbol"in window.currencies[currencySymbol]){var currencyCode=window.currencies[currencySymbol]}else var currencyCode=sitecode=="otomotopl"?"PLN":"RON";var actualDefaultCurrency=category_id&&currenciesCategories[category_id]?currenciesCategories[category_id]:window.defaultCurrency;for(var z in currencies)if(!geoData.params.currency&&actualDefaultCurrency==z){currencySymbol=currencies[z].symbol;currencyCode=z}else if(geoData.params.currency&&geoData.params.currency==z){currencySymbol=currencies[z].symbol;currencyCode=z};return{symbol:currencySymbol,code:currencyCode}},initCurrencies:function(){var thiz=this,currencySymbol=thiz.getCurrentCurrency();$('.numeric-item.price span.header, .numeric-item.salary span.header',thiz.dom.param).each(function(){var $this=$(this),$param=$this.closest('li.param'),key=$param.data('key');if(key=='price'||key=='salary'){var newLabel=$this.data('defaultLabel');if(currencySymbol){if(newLabel.indexOf(' (')==-1){$this.data('defaultLabelShort',newLabel);newLabel=newLabel+' ('+currencySymbol.symbol+')'}else newLabel=$this.data('defaultLabelShort')+' ('+currencySymbol.symbol+')'}else if($this.data('defaultLabelShort'))newLabel=$this.data('defaultLabelShort');$this.data('defaultLabel',newLabel);!$this.parent().hasClass('fbold')&&$this.html(newLabel)}});return currencySymbol},setSearchParams:function(){if($(".advanced-search .paramsList").length<=0)return;var searchParams=geoData.params.search;searchParams=searchParams?searchParams:{};this.dom.filterItems.each(function(){var name=$(this).data('name');if(name&&searchParams[name]){$('select',this).setSelectValue(searchParams[name]);$('input[type=text], input[type=number]',this).val(searchParams[name]);$('input[type=checkbox]',this).each(function(){var val=$(this).val();$(this).prop('checked',(typeof searchParams[name]=='object')?searchParams[name].indexOf(val)>-1:searchParams[name]==val).change()})}});if(typeof q!='undefined')$('#search-text').val(q);if(typeof window.region_id!='undefined'){$('#search-location').val(window.geoData.locationName);$('#search-location').data('regionId',window.region_id);if(typeof window.subregion_id!='undefined')$('#search-location').data('subregionId',window.subregion_id);if(typeof window.city_id!='undefined')$('#search-location').data('cityId',window.city_id);if('district_id'in searchParams)$('#search-location').data('districtId',searchParams.district_id);if('street_id'in searchParams)$('#search-location').data('streetId',searchParams.street_id);if('dist'in searchParams)$('#search-distance').val(searchParams.dist)};$("html, body").animate({scrollTop:0},"slow")},translateValue:function(v){var valueHuman=v;if(valueHuman=='free'){valueHuman='za darmo'}else if(valueHuman=='exchange')valueHuman='zamienię';return valueHuman},initViewButtons:function(){var thiz=this;$('a.topTabView',$('#viewSelector')).click(function(e){var $this=$(this),$hidden=$('input[name="view"]',thiz.dom.form);if(!$hidden.length)$hidden=$('<input type="hidden" name="view" />').appendTo(thiz.dom.form);$hidden.val($this.data('type'));$this.find('span').click(function(){$.cookie('view',$(this).data("view"),{expires:90,path:'/'})});thiz.submitForm(0,true);e.preventDefault()})},initCurrencyButtons:function(){var thiz=this;thiz.dom.body.on('click','a.currency-link',function(){var $this=$(this);$('input[name="currency"]',thiz.dom.form).remove();var actualDefaultCurrency=category_id&&currenciesCategories[category_id]?currenciesCategories[category_id]:window.defaultCurrency;if(actualDefaultCurrency!=$this.data('currency'))$hidden=$('<input type="hidden" name="currency" value="'+$this.data('currency')+'" />').appendTo(thiz.dom.form);var $param=$('.numeric-item.price,.numeric-item.salary',thiz.dom.params);$param.find('.suggestinput').removeClass('binded').text('');$param.find('input[type="text"]').val('');$param.closest('li').find('input.hidden-option').remove();$param.find('a.button').removeClass('fbold').find('.icon').removeClass('clear mini').addClass('down');thiz.submitForm(0,true);return false})},initTopLinks:function(){$('#topLinkShowAll').on('click',function(e){e.preventDefault();$('#topLinkShowAllList').toggle()})},initPopState:function(){var thiz=this;if(!history.pushState||(thiz.isChrome()&&thiz.getChromeVersion()<=33))return true;if(!history.state){history.replaceState({init:true},'title',window.location.href);history.pushState({url:window.location.href},'title',window.location.href)};window.onpopstate=function(event){if(thiz.isChrome()&&thiz.getChromeVersion()>34&&$.cookie('from_detail')==="1"){$.cookie('from_detail',0,{path:'/',domain:'.'+window.session_domain});return false};if(event.state!=null&&!event.state.init){location.replace(event.state.url)}else if(event.state!=null&&event.state.init)history.back()}},initFacets:function($parent){var thiz=this,$bodyContainer=thiz.dom.bodyContainer,facets=$bodyContainer.data('facets')?$bodyContainer.data('facets'):{},categoriesStats=facets.categories?facets.categories:{},showFacets=$bodyContainer.data('showfacets'),$counters=$('span.counterCategory',$parent);if(showFacets){$counters.each(function(){var $this=$(this);if(categoriesStats[$this.data('id')]){$this.html(categoriesStats[$this.data('id')]).removeClass('hidden')}else $this.addClass('hidden')})}else $counters.addClass('hidden')},initSearchOptions:function(){var thiz=this;$('#photo-only, #title-desc, #courier-only').bind('change',function(){thiz.submitForm()})},initOnboardingFlowControl:function(){var searchPreferencesUrl=$.cookie('onboardingSearchPreferencesUrl'),currentUrl=location.href.replace(/.*\/\/[^\/]*/,'');console.log('searchPreferencesUrl');console.log(searchPreferencesUrl);console.log('currentUrl');console.log(currentUrl);if(searchPreferencesUrl==null)return false;if(currentUrl!=searchPreferencesUrl){$.cookie('onboardingSearchPreferencesUrl',null,{path:'/',domain:window.location.hostname.replace('www','')});console.log('Removed cookie.');localStorage.removeItem('searches');return true};return false},submitFormWithAjax:function(){var thiz=this,formData=thiz.dom.form.serializeArray(),data={};for(var i=0,l=formData.length;i<l;i++)if(formData[i].value!=""||data[formData[i].name])data[formData[i].name]=formData[i].value;thiz.post('search','list',thiz.dom.form.serialize(),function(data){thiz.searchSubmitPostCallback(data);thiz.initOnboardingFlowControl();$(window).trigger('onSearchSubmitPostCallbackEnd')});return false},initSubmit:function(){var thiz=this;thiz.dom.form.bind('submit',function(event){$(window).trigger('onBeforeSubmitForm');if(thiz.submitTimer)window.clearTimeout(thiz.submitTimer);thiz.showPageLoader(90,400);if(typeof event.forceNoAjax!='undefined')return true;return thiz.submitFormWithAjax()})},searchSubmitPostCallback:function(data){var thiz=this;thiz.dom.adsContainer.html(data);thiz.initDom();var $bodyContainer=thiz.dom.bodyContainer,url=$bodyContainer.data('ajaxurl');thiz.stopPageLoader();if(url.substring(0,url.indexOf(session_domain))!=document.URL.substring(0,document.URL.indexOf(session_domain))){document.location=url;return false};if(url!=document.URL){var pageTitle=$bodyContainer.data('pagetitle')?$bodyContainer.data('pagetitle'):'';document.title=pageTitle;history.pushState({url:url},pageTitle,url);var $changeLangLink=$('#changeLang');if($changeLangLink.length)$changeLangLink.attr('href',$changeLangLink.data('baselink')+'&l='+url);thiz.historyPushed=true};thiz.initOrder();thiz.initPrevNext();thiz.initFacets(thiz.dom.form);thiz.initFavoritesGalleryBox();thiz.initPager();thiz.initViewButtons();thiz.initTopLinks();thiz.initCurrencies();thiz.initAfterAdsLoad(false);thiz.initAnalyticsEvents();thiz.initHideBottomBanners();$('#order-select-gallery').initSelect(thiz.isMobile());thiz.initAdsense(true);dataLayer.push({event:'VirtualPageview',virtualPageURL:url.replace(www_base,''),virtualPageTitle:$('title').length?$('title').text():'Listing reload'});if((typeof old_gemius_identifier!='undefined')&&(old_gemius_identifier.localeCompare(gemius_identifier)===-1)){old_gemius_identifier=gemius_identifier;gemius_hit(gemius_identifier)};$(window).trigger('ajaxReady')},initFilters:function(){var thiz=this;$('.filterCheckbox',this.dom.filterItems).bind('click touchend',function(){thiz.submitForm(50)});var $business=$('#filter-business'),$private=$('#filter-private'),$authorized=$('#filter-filter_enum_authorized_dealer');$private.on('change',function(){if($(this).prop('checked')){$business.prop('checked',false).change();$authorized.prop('checked',false).change()}});$business.on('change',function(){if($(this).prop('checked'))$private.prop('checked',false).change()});$authorized.on('change',function(){if($(this).prop('checked'))$private.prop('checked',false).change()});if(!thiz.isMobile()){$('input[type=number]',this.dom.filterItems).each(function(i,e){var fblock=$(e).closest('.fblock'),key=fblock.data('key'),ranges=thiz.getSearchRanges(key);if(typeof ranges!='undefined'&&ranges.values.length)$(e).suggest({suggestions:ranges.values,numberThousandsSeparator:key=='year'?'':' ',numberSuffix:(ranges.label?' '+ranges.label:''),inputTo:($(this).attr('name').indexOf(':from')>-1)?fblock.find('input[name="'+$(this).attr('name').replace(':from',':to')+'"]'):null,inputFrom:($(this).attr('name').indexOf(':to')>-1)?fblock.find('input[name="'+$(this).attr('name').replace(':to',':from')+'"]'):null}).change(function(){if(!$(this).hasClass('group'))thiz.submitForm(50)})});$('#search-text, #search-manufacturer_code').each(function(i,e){var $suggestionsPicker=$('<select name="'+$(e).attr('name')+'"></select>');$(e).after($suggestionsPicker);$suggestionsPicker.css({width:'100%'}).addClass('isCustom').select2({placeholder:{id:"",text:$(e).attr('title')},allowClear:true,tags:true,language:window.lang,data:[{id:$(e).val(),text:$(e).val()}],theme:"suggestions nosuggestions"+($(e).data('select2-theme')?' '+$(e).data('select2-theme'):'')});$suggestionsPicker.select2("val",$(e).val());$suggestionsPicker.change(function(){thiz.submitForm(50)});$(e).remove()});$('select:not(#searchFormCatID),input[type=number],input[type="text"]',this.dom.filterItems).change(function(){var $this=$(this);$this.closest('.filter-item').toggleClass('active',$this.val()?true:false);if(!$this.hasClass('group'))thiz.submitForm(50)})};$('#search-location').geosuggest({distancePicker:$('#search-distance'),showPopularLocations:true,allowClear:true,levels:['COUNTRY','REGION','CITY','DISTRICT']});$('#search-location').on('geosuggest:change geosuggest:distancechange',function(){$('#pageHidden').remove();if($('[name="search[country]"]').val()&&$('[name="search[region_id]"]').val())thiz.submitForm(150)});$('select:not(#searchFormCatID),input[type=number],input[type="text"]',this.dom.filterItems).each(function(){var $this=$(this);$this.closest('.filter-item').toggleClass('active',$this.val()?true:false)})},initAdsense:function(ajax){var thiz=this;setTimeout(function(){if(useExternalScripts&&typeof AdsenseClass!='undefined'){if(!ajax)thiz.adsense=new AdsenseClass();thiz.adsense.setQuery(q);thiz.adsense.setRegionName(regionName);thiz.adsense.setSubregionName(subregionName);thiz.adsense.setCategory(category_id,categoryName,categoryCode,categoryAdsenseText);thiz.adsense.setRootCategory(root_category_id,rootCategoryName,rootCategoryCode,rootCategoryAdsenseText);thiz.adsense.setSeoPageName(setSeoPageName);if(q){if(window.isNoResults){thiz.adsense.addAdsenseForSearchBlock('noresults-ads-container',3);thiz.adsense.showAdsenseForSearchAds('noresults')};thiz.adsense.addAdsenseForSearchBlock('adcontainer3',3);thiz.adsense.showAdsenseForSearchAds(totalAds>0?'asf':'asf_empty')}else{thiz.adsense.addAdsenseForContentBlock('google-ads-container3',3,'listing_bottom');thiz.adsense.showAdsenseForContentAds()}};if(ajax&&(typeof loadAdocean=='function'))loadAdocean(true)},150)},initTabs:function(){var thiz=this,tabs={topTabNewUSed:'new_used'},$hidden=$('#pageHidden');for(var x in tabs){var $tabsContainer=$('#tabs-container');$('a.'+x,$tabsContainer).data('key',tabs[x]).click(function(e){if(!history.pushState)e.preventDefault();var $this=$(this),key=$this.data('key');if(!$hidden.length)$hidden=$('<input type="hidden" id="pageHidden" name="page" />').appendTo(thiz.dom.form);$hidden.val(0);$hidden=$('input[name="search['+key+']"]',thiz.dom.form);if(!$hidden.length)$hidden=$('<input type="hidden" name="search['+key+']" />').appendTo(thiz.dom.form);var val=$this.data('type');if(val=='all'){$hidden.remove()}else $hidden.val(val);thiz.submitForm(10);e.preventDefault()})}},submitForm:function(timeout,withPage){var thiz=this;if($('#openFilters').is(':visible'))return false;if(!withPage||$('#pageHidden').val()=='1')$('#pageHidden').remove();if(this.submitTimer!=null)window.clearTimeout(this.submitTimer);if(timeout==0){this.dom.form.submit()}else{if(this.submitTimer)window.clearTimeout(this.submitTimer);this.submitTimer=window.setTimeout(function(){thiz.dom.form.submit()},timeout==undefined?100:parseInt(timeout))}},initClickReport:function(){var thiz=this;if(useExternalScripts){$('a.observe-link').on('click',function(e){var code,icon=$(this).find('span.icon');if(!icon.hasClass('selected')){if(thiz.isMobile()){code='add_clipboard_m'}else code='add_clipboard_d';dataLayer.push({event:code})}});$('ul.om-pager').find('li > a').on('click',function(e){var code;if(thiz.isMobile()){code='pager_click_m'}else code='pager_click_d';dataLayer.push({event:code})});$('#saveSearchCriteria').on('click',function(e){var code;if(thiz.isMobile()){code='add_favorite_m'}else code='add_favorite_d';dataLayer.push({event:code})});var $popular=$('#popular');if($popular!=undefined){var type=$popular.data('type');$popular.find('li > a').on('click',function(e){var code,codeM;if(thiz.isMobile()){codeM='m'}else codeM='d';if(type=='make')code='click_listing_popular_make_'+codeM;if(type=='model')code='click_listing_popular_model_'+codeM;if(type=='category')code='click_listing_popular_category_'+codeM;dataLayer.push({event:code})})}}},initPager:function(){var thiz=this,$pageParam=$('#pageParam');if($pageParam.length>0){$pageParam.val($pageParam.data("currentpage"));var $hidden=$('#pageHidden',thiz.dom.form);if(!$hidden.length)$hidden=$('<input type="hidden" id="pageHidden" name="page" />').appendTo(thiz.dom.form).val($pageParam.val())};thiz.dom.body.on('keydown','#pageParam',function(e){var code=e.keyCode||e.which,accepted_special_keys=[13,46,37,39,8],special_key_pressed=false;for(var i=0;i<accepted_special_keys.length;i++)if(accepted_special_keys[i]==code)special_key_pressed=true;if((special_key_pressed||e.ctrlKey||(/\d/.test(String.fromCharCode((96<=code&&code<=105)?code-48:code))&&!e.shiftKey))){if($('#pageParam').val()==''&&code=='48')return false;return true};return false});if(window.is_archive!=1)$('div.pager a').click(function(){var $this=$(this),page=$this.hasClass('pageNextPrev')?parseInt($this.data("page")):parseInt($('span',$this).text());if(!page||isNaN(page))page=parseInt($this.parent().prev().find('a span').text());var $hidden=$('#pageHidden',thiz.dom.form);if(!$hidden.length)$hidden=$('<input type="hidden" id="pageHidden" name="page" />').appendTo(thiz.dom.form);$hidden.val(page);$('html, body').scrollTop(0);thiz.submitForm(100,true);return false});$('#showAllLocations').click(function(){$(this).next('.all-locations').removeClass('hidden');$(this).remove()})},initFavoritesGalleryBox:function(){ObserveObject.scale($('li > .card',$('#favsearchgallerybox')),0.35);var $galleryBox=$('#favoritesGalleryBox');if(!$galleryBox.length)return;$('ul.tabsfav > li',$galleryBox).click(function(e){var $this=$(this),$tab=$this.children('span');if(!$tab.hasClass('selected')){if($this.hasClass('lastSeen')){ObserveObject.getContentTab('lastSeen',typeof e.originalEvent!='undefined')}else if($this.hasClass('observedAds')){ObserveObject.getContentTab('observedAds',typeof e.originalEvent!='undefined')}else if($this.hasClass('observedSearches'))ObserveObject.getContentTab('observedSearches',typeof e.originalEvent!='undefined');$galleryBox.find('ul.tabsfav > li > span').removeClass('selected');$tab.addClass('selected')}});$('a.observeChange',$('#tab-lastSeen')).click(function(e){e.preventDefault();var $this=$(this),$icon=$this.find('span'),adId=$this.data("adId");if($icon.hasClass('selected')){ObserveObject.removeAdFromObserved(adId,$('.observed-'+adId).parent())}else ObserveObject.addAdToObserved(adId,$('.observed-'+adId).parent())});if(window.location.href.search('#tab-')>0){var tabName=window.location.href.substr(window.location.href.search('#tab-')+5,window.location.href.length),$liTab=$galleryBox.find('li.'+tabName);if($liTab.not('.hidden').length>0){$liTab.click()}else $('> ul > li',$galleryBox).not('.hidden').first().click()}else $('> ul > li',$galleryBox).not('.hidden').first().click()},initFiltersDialog:function(){var thiz=this,setText=function($filterLayer,groupCustomFilter){var text=[];$filterLayer.find('input, select').each(function(){var $input=$(this),txt;if($input.is('select')){var label=$input.data('title');if(label!=''&&label!=undefined&&$input.find('option:selected').text()!=''){txt=label+'('+$input.find('option:selected').text()+')'}else txt=$input.find('option:selected').text()}else if($input.prop('type')=='checkbox'){txt=$input.prop('checked')?$input.data('label'):''}else txt=$input.val();if(txt)text.push(txt)});if(text.length){groupCustomFilter.addClass('active');groupCustomFilter.find('[class*="icon-"]').removeClass().addClass('icon-zamknij');groupCustomFilter.find('span.groupValue').text(text.join(', '));groupCustomFilter.find('span.groupCount').text('('+text.length+')');groupCustomFilter.find('[class*="icon-"]').off('click').on('click',function(e){e.preventDefault();e.stopPropagation();$filterLayer.find('input[type="text"]').val('');$filterLayer.find('input[type="checkbox"]').attr('checked',false);$filterLayer.find('select').setSelectValue();$filterLayer.find('input[type]');$(this).removeClass().addClass('icon-dropdownarrow');groupCustomFilter.removeClass('active');groupCustomFilter.find('span.groupValue').text(groupCustomFilter.find('span.groupName').text());$(this).off('click');thiz.submitForm(50)})}else{groupCustomFilter.find('span.groupValue').text(groupCustomFilter.find('span.groupName').text());groupCustomFilter.find('span.groupCount').text('');groupCustomFilter.removeClass('active');groupCustomFilter.find('[class*="icon-"]').removeClass().addClass('icon-dropdownarrow')}};$('.groupCustomFilter').each(function(){var groupCustomFilter=$(this),filterType=groupCustomFilter.data('custom-filter'),filterLayer='#layer-filter-'+filterType,$filterLayer=$(filterLayer);setText($filterLayer,groupCustomFilter)});$('.groupCustomFilter').on('click',function(){var groupCustomFilter=$(this),filterType=groupCustomFilter.data('custom-filter'),filterLayer='#layer-filter-'+filterType,$filterLayer=$(filterLayer);$filterLayer.on({'shown.bs.modal':function(){thiz.submitAfterModalClose=false;$('.clear-all-filters').click(function(e){e.preventDefault();var $this=$(this),$filterBox=$this.closest('.om-filters-dialog');$filterBox.find('input[type="text"]').val('');$filterBox.find('input[type="checkbox"]').attr('checked',false);$filterBox.find('select').setSelectValue('')})},'hidden.bs.modal':function(){if(thiz.submitAfterModalClose){if($filterLayer.find('input').length)setText($filterLayer,groupCustomFilter);thiz.submitForm(50)}}}).modal('show');return false});$(thiz.dom.form).on('click touchend','.submitGroup',function(){thiz.submitAfterModalClose=true;$('.modal').modal('hide')});var $filtersButton=$('.menu-filters'),$alternativeFiltersButton=$('.button-show-filters'),$filtersForm=$('#form');$filtersButton.on('click',function(e){e.preventDefault();$filtersForm.addClass('on');thiz.toggleElementsVisibility(false);return true});$filtersButton.on('click',function(e){e.preventDefault();$filtersForm.addClass('on');thiz.toggleElementsVisibility(false);return true});$alternativeFiltersButton.on('click',function(e){e.preventDefault();$filtersForm.addClass('on');thiz.toggleElementsVisibility(false);return true});$('#submit-filters').on('click',function(e){$filtersForm.removeClass('on');thiz.toggleElementsVisibility(true);return true});if(window.location.hash=='#form'){$filtersForm.addClass('on');if(thiz.isMobile())thiz.toggleElementsVisibility(false)};$('#form .close-filters-mobile').on('click',function(e){e.preventDefault();$filtersForm.removeClass('on');thiz.toggleElementsVisibility(true)})},toggleElementsVisibility:function(show){if(show){var bannerProps={display:'block',height:'auto',overflow:'auto'},elementsProps={display:'block'}}else{var bannerProps={display:'none',height:'1px',overflow:'hidden'},elementsProps={display:'none'}};$('.mobile-banner').css(bannerProps);$('#listContainer, .footer-container, .helpinfo').css(elementsProps)},initContactLayer:function(thiz){$('body').on('click','.contact-button',function(e){e.preventDefault();e.stopPropagation();var $this=$(this),$contactLayer=$this.closest('.contact-box').find('.om-contact-layer');$('.om-contact-layer','.offer-item').addClass('hidden');if(!$this.hasClass('active')){$contactLayer.removeClass('hidden');$this.removeClass('active');$this.addClass('active')}else{$contactLayer.addClass('hidden');$this.removeClass('active')};$(document).on('click',function(e){var $el=$('.om-contact-layer');if(!$el.is(e.target)&&$el.has(e.target).length===0){$this.removeClass('active');$el.addClass('hidden')}});if(useExternalScripts&&!$(this).hasClass('triggerDone')){var code='';if(thiz.isMobile()){code='message_listing_m'}else code='message_listing_d';if(code!=''){$(this).addClass('triggerDone');dataLayer.push({event:code})}}});$('body').on('click','.close-contact-layer',function(e){var $this=$(this);e.preventDefault();$this.closest('.om-contact-layer').addClass('hidden');$this.removeClass('active')})},startContactFormValidator:function($formSelector){var thiz=this,rulesObj={'contact[txt]':{required:true,maxlength:5e3,minlength:20},'contact[email]':{required:true,maxlength:255,email:true},'contact[captcha]':{required:true}};if(thiz.isModuleActive('answers_with_phone'))if(sitecode=='otomotopl'){rulesObj['contact[phone]']={maxlength:9,digits:true,minlength:9}}else if(sitecode=='autovitro'){rulesObj['contact[phone]']={maxlength:15,digits:true,minlength:10}}else rulesObj['contact[phone]']={maxlength:15};if((!thiz.isIE()||thiz.getIEVersion()>7))$formSelector.each(function(){$(this).validate({rules:rulesObj,debug:true,console:true,submitHandler:function(form){thiz.submitAjaxContactForm(form)}}).showErrorsFromAction()});if(typeof $.fn.renderForms=='function')$formSelector.renderForms()},submitAjaxContactForm:function(form){$successInfo='<div class="form-sent-info"> \
							<span class="icon-checkmark"></span> \
							<h5>Twoja wiadomość została wysłana.</h5>\
							<p>'+www_message_history+'</p>\
							</div>';var thiz=this;$.ajax({type:'POST',url:www_base+'/ajax/ads/contact/',async:true,dataType:'json',data:$(form).serialize(),beforeSend:function(){$(form).find('input[type="submit"]').attr('disabled','disabled');$('fieldset',form).addClass('form-sent');if(!$('.loaderContainer').length){$('<div class="loaderContainer"><div class="loader"></div>Ładowanie...</div>').appendTo($(form)).show()}else $('.loaderContainer').show()},error:function(obj,status,errorTrown){$('.loaderContainer').hide();$(form).find('input[type="submit"]').removeAttr('disabled');$('fieldset',form).removeClass('form-sent');console.log(errorTrown,status);return false},success:function(data){$('.loaderContainer').hide();$($successInfo).appendTo($(form)).fadeIn(300);if(useExternalScripts){var code='';if(thiz.isMobile()){code='message_send_listing_m'}else code='message_send_listing_d';var adId=$(form).find('.adId').val(),myxt=xtcustom;myxt.action_type='message_sent';myxt.touch_point_page='listing';myxt.ad_id=adId;delete myxt.page_name,myxt.page_nb;xt_med('C','','&stc='+escape(JSON.stringify(myxt)),'A');if(code!='')dataLayer.push({event:code})};return false}})},initStickySkyScraper:function(){if(typeof $('.stickyGPT').length!='undefined'&&document.body.clientWidth>1024){var $sidebar=$('.stickyGPT');if($sidebar.length){var $window=$(window),offset=$sidebar.offset(),topMargin=80,sidebarHeight=0,contentSize=0,top=0;$window.off("scroll",setStickySkyScraper).on("scroll",setStickySkyScraper.throttle(50))}}
function setStickySkyScraper(){var $offers=$(".offers.list"),listContainerOffset=$('.om-list-container').offset();sidebarHeight=$('.stickyGPT').outerHeight();contentEnd=(listContainerOffset?listContainerOffset.top:0)+$('.om-list-container').outerHeight();if($window.scrollTop()>(offset.top-topMargin)){if(($window.scrollTop()+sidebarHeight)>contentEnd){$sidebar.css({position:'absolute',top:0});$(window).trigger("stickyBanner.onUnstick")}else{if(typeof $offers.offset()!=='undefined')$sidebar.css({position:'fixed',top:'60px',right:'auto'});$(window).trigger("stickyBanner.onStick")}}else{$sidebar.css({position:'absolute',top:0,right:0});$(window).trigger("stickyBanner.onUnstick")}}},initMultiShowNumber:function(){var thiz=this;$('body').on('click','[data-bind="phone-spoiler"] .spoiler',(function(){var $this=$(this),$phoneBox=$this.parent().find('.phone-number'),metadata=$this.data(),url=www_base_ajax+'/misc/contact/';url+=metadata.path+'/';url+=metadata.id+'/';url+=metadata.index+'/';$.get(url,function(response){$phoneBox.html(response.value);if(thiz.isPhone()){var $numberBox=$this.closest('.number-box'),$callButton=$('<a class="om-button" href="tel:'+response.value+'">Zadzwoń</a>');$callButton.data('ninja-extradata',$this.data('ninja-extradata'));$callButton.appendTo($numberBox)};$this.unbind('click').hide()});if(useExternalScripts){var code='',p='showing_phone_listing',adId=$this.parent().parent().next('form.quick-contact-form').find('.adId').val();if(thiz.isMobile()){code='phone_listing_m'}else code='phone_listing_d';var myxt=xtcustom;myxt.ad_id=adId;myxt.action_type='showing_phone_listing';myxt.touch_point_page='listing';delete myxt.page_name;xt_med('C','',p+'&stc='+escape(JSON.stringify(myxt)),'A');if(code!='')dataLayer.push({event:code})};return false}))},initABTestSearchOnLeft:function(){var forceVariation=(new BaseClass()).getQueryVariable("force_b_version"),cookieName="abtest-search-left-variation",cssClass="abtest-search-loaded";if(document.body.clientWidth<=1024)return;if(forceVariation)$.cookie(cookieName,"b",{path:'/'});if("ABTestSearchOnLeft"in window&&$.cookie(cookieName)=="b")ABTestSearchOnLeft.init();$("body").addClass(cssClass)},initGptStickyClose:function(){$(window).on("googletag.onReady",function(){googletag.pubads().addEventListener('impressionViewable',function(event){$(".sticky-gpt-close").show().bind("click",function(){$("#div-gpt-rwd-listing-billboard-1").remove();$("#div-gpt-rwd-listing-mob-ldb-2").remove()})})});if(typeof googletag!=="undefined"){googletag.cmd.push(function(){$(window).trigger("googletag.onReady")})}else $(window).on("load",function(){if(typeof googletag!=="undefined")googletag.cmd.push(function(){$(window).trigger("googletag.onReady")})})},setFavoriteButtonTrackingKey:function(){$(".favorite-button").attr("data-statkey","ad.observed.list")},initHideBottomBanners:function(){var offersLength=$('.offer-item').length;if(offersLength<15)$('.hidden-short-list').remove()},initAtiTracking:function(){if(this.isModuleActive('atinternet_tracking_v2_set_2016')===false)return;var thiz=this,moreXt={};moreXt.touch_point_page='listing';$('[data-tracking="listContainer"]').on('click','[data-tracking="link-dealer-page"]',function(){thiz.doAtiTrackingClickEvent('seller_listing',moreXt)});$('[data-tracking="listContainer"]').on('click','[data-tracking="favourite_ad_click"]',function(){moreXt.ad_id=$(this).data('id');thiz.doAtiTrackingClickEvent('favourite_ad_click',moreXt)});$('[data-tracking="listContainer"]').on('click','[data-tracking="contact_button_click"]',function(){moreXt.ad_id=$(this).data('id');thiz.doAtiTrackingClickEvent('contact_button_click',moreXt)});$('[data-tracking="listContainer"]').on('click','[data-tracking="popular_keyword_click"]',function(){moreXt.extra_data=$('#popular').data('tracking-type');moreXt.keyword=$(this).data('id');thiz.doAtiTrackingClickEvent('popular_keyword_click',moreXt);delete moreXt.extra_data;delete moreXt.keyword});$('[data-tracking="category_change_click"]').on('click',function(){moreXt.category=$(this).attr('data-tracking-code');thiz.doAtiTrackingClickEvent('category_change_click',moreXt)});$('[data-tracking="listContainer"]').on('click','[data-tracking="listing_new_used_click"]',function(){moreXt.touch_point_button=$(this).data('type');thiz.doAtiTrackingClickEvent('listing_new_used_click',moreXt);delete moreXt.touch_point_button});$('[data-tracking="listContainer"]').on('click','[data-tracking="listing_view_change"]',function(){moreXt.touch_point_button=$(this).data('type')==='galleryWide'?'gallery':$(this).data('type');thiz.doAtiTrackingClickEvent('listing_view_change',moreXt);delete moreXt.touch_point_button});$('[data-tracking="listContainer"]').on('click','[data-tracking="favourite_search_save"]',function(){thiz.doAtiTrackingClickEvent('favourite_search_save',moreXt)});$('[data-tracking="login_click"]').on('click',function(){if(window.user_logged==0)thiz.doAtiTrackingClickEvent('login_page',touchPointPage,false)});$('[data-tracking="logout"]').on('click',function(){moreXt.page_name='logout';thiz.doAtiTrackingClickEvent('logout',moreXt)})},doAtiTrackingClickEvent:function(actionType,moreXt){var myxt=xtcustom,xt=$().extend({},myxt,moreXt);xt.action_type=actionType;delete xt.page_name;if(actionType==='category_change_click'){var keys=Object.keys(xt);for(var i=0;i<keys.length;i++)if(keys[i].endsWith('_filt'))delete xt[keys[i]];delete xt.page_nb};xt_med('C','',actionType+'&stc='+escape(JSON.stringify(xt)),'A')},trackListing:function(){var offersReported=[],$offers,isGallery=false;if($('.offer-item').length>0){$offers=$(".offer-item")}else if($('.gallery-offer-item').length>0){$offers=$(".gallery-offer-item");isGallery=true};var limitValue=this.getRowIndex(),moreXt={},elThis=this;$(window).on('scroll load',function(){if(typeof $offers==="undefined")return;$offers.each(function(index){var offerId=''+$(this).find("[data-ad-id]:first").data("ad-id");if(inViewport(this)&&!~offersReported.indexOf(offerId)){offersReported.push(offerId);moreXt.ad_id=offerId;moreXt.ad_position=(index+1)+limitValue;moreXt.touch_point_page="listing";elThis.doAtiTrackingClickEvent('ad_impression',moreXt)}})}.throttle(2e3));$(window).on('onSearchSubmitPostCallbackEnd',function _updateCollection(){$offers=isGallery?$(".gallery-offer-item"):$(".offer-item")})},getRowIndex:function(){var numberPage=1,pageElement=$('#pageParam');if(pageElement.length&&pageElement.attr("data-currentpage")>1)numberPage=pageElement.attr("data-currentpage");return numberPage*perPageAds-perPageAds},initAdsEvents:function(){if('AdsEvents'in window)AdsEvents.init()},initStickyAdSlotHalfPage:function(){var isDesktop=document.body.clientWidth>1024;if(typeof StickyElements!=="undefined"&&isDesktop){var marginTop=15,topPosition=$(".header-container").height()+marginTop,unstickyReference=".om-pager",pagerExists=$(unstickyReference).length;if(!pagerExists)unstickyReference=".helpinfo";StickyElements.init({momentToStick:'hit',targetSelector:".stickyGPT",top:topPosition,unstickReference:unstickyReference,baselineWhenUnstick:true});if(typeof googletag!=="undefined")googletag.cmd.push(function(){googletag.pubads().addEventListener('slotRenderEnded',function(event){if(!event.isEmpty)StickyElements.updateLimits()})})}},initMegaAdSlotHandler:function(){if('MegaAdSlot'in window)MegaAdSlot.init()},initSatiTracking:function(){if('SATI_TrackView'in window)$(window).on('onSearchSubmitPostCallbackEnd',function(){SATI_TrackView(document.location.href,document.referrer)})},initGetLogEventsOnFavorites:function(){$('.favorite-button').on('getlogEventsOnFavorites',function(e){AdsEvents.logFavorites($(this).parents('.offer-item').data('ad-id'))})},initAdEvents:function(){if('AdsEvents'in window)AdsEvents.init()},initPreviewAd:function(){var $listingPreview=$('article.listing-preview');if(this.isMobileBreakpoint())return;if($listingPreview.length){var $tabsContainer=$('#tabs-container'),offset=$tabsContainer.length?$tabsContainer.offset().top:$listingPreview.offset().top,timeOut=setTimeout(function(){$('html, body').animate({scrollTop:(offset-55)},'ease-out');if(timeOut)clearTimeout(timeOut)},1e3)}},isMobileBreakpoint:function(){return this.isMobile&&document.body.clientWidth<768}});(function($,ninjaPV,NinjaTracker){'use strict';includeOptimizelyExperimentsData();var defaultLinkCallBack=function(){var href=this.selector.attr('href');return function(){if(!href)return;window.location.href=href}},touchPointPage=ninjaPV.trackPage||'home';$('a.postnewlink.icon-plus').trackNinja('click',{params:{trackEvent:['posting_form_click'],action_type:'posting_form_click',event_type:'click',touch_point_page:touchPointPage,touch_point_button:'top'}});$('.nav-box-mobile a.icon-plus').trackNinja('click',{params:{trackLinkEvent:['posting_form_click'],action_type:'posting_form_click',event_type:'click',touch_point_page:touchPointPage,touch_point_button:'top',linkCallBack:defaultLinkCallBack}});new NinjaTracker('.burger-nav a.newad-link','click',{params:{trackLinkEvent:['posting_form_click'],action_type:'posting_form_click',event_type:'click',touch_point_page:touchPointPage,touch_point_button:'menu',linkCallBack:defaultLinkCallBack}});$('#login-box-logout').trackNinja('click',{params:{trackLinkEvent:['logout'],action_type:'logout',event_type:'click',touch_point_page:touchPointPage,linkCallBack:defaultLinkCallBack}});new NinjaTracker('a.logout-link','click',{params:{trackLinkEvent:['logout'],action_type:'logout',event_type:'click',touch_point_page:touchPointPage,linkCallBack:defaultLinkCallBack}});$('a.cat[data-ninja-extradata]').trackNinja('click',{params:{trackLinkEvent:['posting_category_click'],action_type:'posting_category_click',event_type:'click',touch_point_page:'posting',linkCallBack:defaultLinkCallBack}});new NinjaTracker('#smartbanner .sb-button','click',{params:{trackEvent:['download_app'],action_type:'download_app',event_type:'click',touch_point_page:touchPointPage,linkCallBack:defaultLinkCallBack}});new NinjaTracker('#404GenericGoHome','click',{params:{trackEvent:['error_404_home_click'],action_type:'error_404_home_click',event_type:'click',touch_point_page:touchPointPage,touch_point_button:'404_generic',linkCallBack:defaultLinkCallBack}});new NinjaTracker('#404GenericGoSearch','click',{params:{trackEvent:['error_404_search_click'],action_type:'error_404_search_click',event_type:'click',touch_point_page:touchPointPage,touch_point_button:'404_generic',linkCallBack:defaultLinkCallBack}});new NinjaTracker('#404GenericGoHelp','click',{params:{trackEvent:['error_404_help_click'],action_type:'error_404_help_click',event_type:'click',touch_point_page:touchPointPage,touch_point_button:'404_generic',linkCallBack:defaultLinkCallBack}});new NinjaTracker('#404-button-dealer-region-search','click',{params:{trackEvent:['error_404_dealers_click'],action_type:'error_404_dealers_click',event_type:'click',touch_point_page:touchPointPage,touch_point_button:'404_dealer',linkCallBack:defaultLinkCallBack}});new NinjaTracker('#404-button-dealer-homepage','click',{params:{trackEvent:['error_404_home_click'],action_type:'error_404_home_click',event_type:'click',touch_point_page:touchPointPage,touch_point_button:'404_dealer',linkCallBack:defaultLinkCallBack}});new NinjaTracker('#404-button-dealer-search','click',{params:{trackEvent:['error_404_search_click'],action_type:'error_404_search_click',event_type:'click',touch_point_page:touchPointPage,touch_point_button:'404_dealer',linkCallBack:defaultLinkCallBack}});new NinjaTracker('#404AdGoSearch','click',{params:{trackEvent:['error_404_search_click'],action_type:'error_404_search_click',event_type:'click',touch_point_page:touchPointPage,touch_point_button:'404_offer',linkCallBack:defaultLinkCallBack}})
function includeOptimizelyExperimentsData(){if(window.hasOwnProperty("optimizelyDataForNinja"))if(typeof NinjaTracker.setCommonExtraParams=="function")NinjaTracker.setCommonExtraParams(window.optimizelyDataForNinja)};if($('#offersNewsletterModal').length){$(document).trackNinja('allegro_email_impression',{params:{trackEvent:['allegro_email_impression'],action_type:'allegro_email_impression',event_type:'impression',touch_point_page:touchPointPage}});$('#offersNewsletterModalClose').trackNinja('click',{params:{trackEvent:['allegro_email_close'],action_type:'allegro_email_close',event_type:'click',touch_point_page:touchPointPage}});var getOffersSubscriptionButtonTouchPoint=function(){return $('#offersNewsletterModal form [name="email"]').val()!==''?'email':'no_email'};$('#offersNewsletterModal form .om-button').trackNinja('click',{params:{trackEvent:['allegro_email_sent'],action_type:'allegro_email_sent',event_type:'click',touch_point_page:touchPointPage},onEvent:function(e){return{touch_point_button:getOffersSubscriptionButtonTouchPoint()}}})};if($('.receiveOffersSubscriptionButton').length)$('.receiveOffersSubscriptionButton').trackNinja('click',{params:{trackEvent:['allegro_receive_alerts'],action_type:'allegro_receive_alerts',event_type:'click',touch_point_page:touchPointPage}})})(jQuery,window.ninjaPV||window.dataLayer[0],window.NinjaTracker);var isOverAds=false;if(GPT.slots!=='undefined'){var pageSlots=getPageSlots();$(window).focus();$(pageSlots).mouseenter(function(){isOverAds=true});$(pageSlots).mouseleave(function(){isOverAds=false});$(window).blur(function(){windowLostBlur()})};windowLostBlur=function(){if(isOverAds){window.ninjaPV={trackEvent:['advert_click'],action_type:'advert_click',event_type:'click',touch_point_page:ninjaPV.trackPage||null};window.dataLayer=window.dataLayer||[];window.dataLayer.push(window.ninjaPV)}}
function getPageSlots(){var allSlots='';for(var key in GPT.slots){var objKey=GPT.slots[key];if(objKey.hasOwnProperty('divId'))allSlots+=(key>0?', #':'#')+GPT.slots[key].divId};return allSlots};window.onload=function(){if(typeof window.optimizely=="object"&&window.optimizely.data.state.activeExperiments.length>0){var dataExperiments=[];optimizely.data.state.activeExperiments.forEach(function(experimentId){dataExperiments.push(experimentId+":"+optimizely.data.state.variationIdsMap[experimentId][0])});window.ninjaPV={trackEvent:['opt_experiments'],action_type:'opt_experiments',opt_experiment:dataExperiments,touch_point_page:ninjaPV.trackPage||null};window.dataLayer=window.dataLayer||[];window.dataLayer.push(window.ninjaPV)}};(function($,NinjaTracker,ninjaPV){'use strict';if(typeof ninjaPV!=='object'){console.log('ninjaPV must be an object, given:',ninjaPV);return};var touchPointPage='listing',defaultLinkCallBack=function(){var href=this.selector.attr('href');return function(){window.location.href=href}},defaultSubmitCallBack=function(){var parentForm=this.selector.closest('form');return function(){parentForm.submit()}};if(document.body.clientWidth<=1024){trackSelect();trackInputField()}else{trackSelect2();trackInputField2()};trackDialogEvents();trackLocationSelect2();$(this).data('isOpenSent',false)
function trackDialogEvents(){$('.paramsList .filter-item a.button').trackNinja('click',{params:{event_type:'click',touch_point_button:null},onEvent:function(){var eventName='dialog_filters';eventName=eventName+'_start';var paramGroup=this.selector.attr('data-custom-filter');return{trackEvent:[eventName],action_type:eventName,touch_point_button:paramGroup}}});$('.submit-dialog-group').trackNinja('click touchend',{params:{event_type:'click',touch_point_button:null},onEvent:function(){var eventName='dialog_filters';eventName=eventName+'_valid';var paramGroup=this.selector.attr('data-custom-filter');return{trackEvent:[eventName],action_type:eventName,touch_point_button:paramGroup}}});$('.om-filters-dialog button.close-filter-group').trackNinja('click touchend',{params:{event_type:'click',touch_point_button:null},onEvent:function(){var eventName='dialog_filters';eventName=eventName+'_close';var paramGroup=this.selector.attr('data-custom-filter');return{trackEvent:[eventName],action_type:eventName,touch_point_button:paramGroup}}});$('a.close-filters-mobile').trackNinja('click',{params:{event_type:'click',touch_point_button:null},onEvent:function(){var eventName='filters_mobile_close';return{trackEvent:[eventName],action_type:eventName}}});$('.clear-all-filters').trackNinja('click',{params:{event_type:'click',touch_point_button:null},onEvent:function(){var eventName='dialog_filters';eventName=eventName+'_clear';var paramGroup=this.selector.attr('data-custom-filter');return{trackEvent:[eventName],action_type:eventName,touch_point_button:paramGroup}}});$('.paramsList .filters-search-box input').trackNinja('click',{params:{event_type:'click',touch_point_button:null},onEvent:function(){var eventName='search_text';eventName=eventName+'_start';return{trackEvent:[eventName],action_type:eventName}}})}
function trackInputField2(){$("#search_freetext").on("select2:open",":input",function(){filterPushEventData('search_text_start',null);filterSendEvent()})}
function trackInputField(){$('.paramsList input[type=number], .paramsList input[type=search]').trackNinja('focus',{params:{event_type:'click',touch_point_button:null},onEvent:function(){var eventName=getFilterParsedName(this.selector.attr('name')),touchPointButton=getFromToTouchPointButton(eventName);eventName=removeFieldFromTo(eventName);eventName=eventName+'_start';return{trackEvent:[eventName],action_type:eventName,touch_point_button:touchPointButton}}});$('.paramsList input[type=number], .paramsList input[type=search]').trackNinja('blur',{params:{event_type:'click',touch_point_button:null},validate:function(){var value=this.selector.val();return!!value&&value.length>0},onEvent:function(){var eventName=getFilterParsedName(this.selector.attr('name')),touchPointButton=getFromToTouchPointButton(eventName);eventName=removeFieldFromTo(eventName);if(this.selector.valid()!==0)eventName=eventName+'_valid';return{trackEvent:[eventName],action_type:eventName,touch_point_button:touchPointButton}}})}
function trackSelect2(){$('.paramsList select').on('select2:close',function(){$(this).data('isOpenSent',false)});$('.paramsList select').trackNinja('select2:open',{params:{trackEvent:null,action_type:null,event_type:'click',touch_point_button:null},validate:function(){return!this.selector.data('isOpenSent')},onEvent:function(){this.selector.data('isOpenSent',true);var eventName=getFilterParsedName(this.selector.attr('name'));if(eventName===undefined)return;eventName=eventName+'_start';return{trackEvent:[eventName],action_type:eventName}}});$('.paramsList select').trackNinja('select2:select',{params:{trackEvent:null,action_type:null,event_type:'click',touch_point_button:null},onEvent:function(){this.selector.data('isOpenSent',true);var eventName=getFilterParsedName(this.selector.attr('name'));if(eventName===undefined)return;eventName=eventName+'_valid';return{trackEvent:[eventName],action_type:eventName}}});trackInputSelects2('param_price','price');trackInputSelects2('param_first_registration_year','year');trackInputSelects2('param_year','year');trackInputSelects2('param_mileage','mileage');trackInputSelects2('param_power','power')}
function trackLocationSelect2(){var eventTypeOpen=false;$(".location-li").on("select2:open",":input",function(){if(eventTypeOpen)return;filterPushEventData('search_location_start',null);eventTypeOpen=true;filterSendEvent()}).on("select2:select",":input",function(){filterPushEventData('search_location_valid',null);eventTypeOpen=true;filterSendEvent()}).on("select2:close",":input",function(){eventTypeOpen=false})}
function trackInputSelects2(divId,eventType){var eventTypeFromOpen=false,eventTypeToOpen=false;$('#'+divId).on("select2:open","select.min-value-input",function(){filterPushEventData(eventType+'_start','from');if(eventTypeFromOpen)return;eventTypeFromOpen=true;filterSendEvent()}).on("select2:select","select.min-value-input",function(){filterPushEventData(eventType+'_valid','from');eventTypeFromOpen=false;filterSendEvent()}).on("select2:close","select.min-value-input",function(){eventTypeFromOpen=false});$('#'+divId).on("select2:open","select.max-value-input",function(){filterPushEventData(eventType+'_start','to');if(eventTypeToOpen)return;eventTypeToOpen=true;filterSendEvent()}).on("select2:select","select.max-value-input",function(){filterPushEventData(eventType+'_valid','to');eventTypeToOpen=false;filterSendEvent()}).on("select2:close","select.max-value-input",function(){eventTypeToOpen=false})}
function trackSelect(){$('.paramsList select').on('blur focus change',function(){$(this).data('isOpenSent',false)});$('.paramsList select').trackNinja('focus',{params:{trackEvent:null,action_type:null,event_type:'click',touch_point_button:null},validate:function(){return!this.selector.data('isOpenSent')},onEvent:function(){this.selector.data('isOpenSent',true);var eventName=getFilterParsedName(this.selector.attr('name'));if(eventName===undefined)return;eventName=eventName+'_start';return{trackEvent:[eventName],action_type:eventName}}});$('.paramsList select').trackNinja('change',{params:{trackEvent:null,action_type:null,event_type:'click',touch_point_button:null},onEvent:function(){this.selector.data('isOpenSent',true);var eventName=getFilterParsedName(this.selector.attr('name'));if(eventName===undefined)return;eventName=eventName+'_valid';return{trackEvent:[eventName],action_type:eventName}}})};$('.paramsList select').trackNinja('select2:unselect',{params:{trackEvent:null,action_type:null,event_type:'click',touch_point_button:null},onEvent:function(){this.selector.data('isOpenSent',false);var eventName=getFilterParsedName(this.selector.attr('name'));if(eventName===undefined)return;eventName=eventName+'_clear';return{trackEvent:[eventName],action_type:eventName}}})
function filterPushEventData(eventName,touchPointButton){window.ninjaPV={trackEvent:[eventName],action_type:eventName,event_type:'click',touch_point_button:touchPointButton||null}}
function filterSendEvent(){window.dataLayer=window.dataLayer||[];window.dataLayer.push(window.ninjaPV)}
function getFilterParsedName(fieldName){var name=fieldName.replace(/[\[\]]+/g,'_');name=name.replace(/_$/g,'');name=name.replace(/(data_|param_|search_|filter_enum_|filter_float_|-from|-to)/g,'');return name}
function getFromToTouchPointButton(event){if(event.indexOf(':from')>-1)return'from';if(event.indexOf(':to')>-1)return'to';return null}
function removeFieldFromTo(fieldName){return fieldName.replace(/(:from|:to)/g,'')};new NinjaTracker('#submit-filters','click',{params:{trackLinkEvent:['search'],action_type:'search',event_type:'click',touch_point_page:touchPointPage,linkCallBack:defaultSubmitCallBack}});new NinjaTracker('a.topTabView','click',{params:{trackEvent:['listing_view_change'],action_type:'listing_view_change',event_type:'click',touch_point_button:null},onEvent:function(){var touchPointButton='list';if(this.selector.children('#gallery').length)touchPointButton='gallery';return{touch_point_button:touchPointButton}}});new NinjaTracker('#order-select-gallery','change',{params:{trackEvent:['sort_order_change'],action_type:'sort_order_change',event_type:'click'}});new NinjaTracker('#saveSearchCriteria','mousedown',{params:{trackEvent:['favourite_search_save'],action_type:'favourite_search_save',event_type:'click',touch_point_page:touchPointPage}});new NinjaTracker('#cancelSearchCriteriaLink','mousedown',{params:{trackEvent:['favourite_search_deleted'],action_type:'favourite_search_deleted',event_type:'click',touch_point_page:touchPointPage}});new NinjaTracker('a.observe-link','favoriteClicked',{params:{trackEvent:['favourite_ad_click'],action_type:'favourite_ad_click',event_type:'click',ad_id:null,touch_point_page:touchPointPage},onEvent:function(){var isFavorite=this.selector.hasClass('is-favorite'),trackEv=isFavorite?'favorite_ad_deleted':'favourite_ad_click',params={trackEvent:[trackEv],action_type:trackEv},isInPreview=this.selector.parent().hasClass('in-preview');if(isInPreview)params.touch_point_button='ad_preview_card';return params}});new NinjaTracker('.offer-item a.offer-item__photo-link, .offer-item a.offer-title__link, .gallery-offer-item a.detailsLink','click',{params:{trackLinkEvent:['ad_click'],action_type:'ad_click',event_type:'click',touch_point_page:touchPointPage,ad_id:null,linkCallBack:defaultLinkCallBack}});new NinjaTracker('.topLink:visible','click',{params:{trackLinkEvent:['popular_keyword_click'],action_type:'popular_keyword_click',event_type:'click',touch_point_page:touchPointPage,touch_point_button:null,linkCallBack:defaultLinkCallBack}});$('.offers.list .brand-program a').trackNinja('click',{params:{trackEvent:['brand_program_click'],action_type:'brand_program_click',event_type:'click',ad_id:null,touch_point_page:touchPointPage,linkCallBack:defaultLinkCallBack},onEvent:function(){var brandProgram={brand_program:this.selector.data('name')};return brandProgram}});var adImpressionsTracking={params:{trackEvent:['ads_impression'],action_type:'ads_impression',event_type:'impression',touch_point_page:touchPointPage},onEvent:function(){var impressions=[],positions=[],positionCounter=1,paginationFactor=ninjaPV.results_per_page*(ninjaPV.page_nb-1);$('.offer-item, .gallery-offer-item').each(function(){var anchor=$(this).find('a[data-ninja-extradata]'),extraData=anchor.data('ninja-extradata');if(typeof extraData==='undefined')return;var adId=extraData.ad_id;if(!isNaN(adId)&&impressions.indexOf(parseFloat(adId))<0){impressions.push(parseFloat(adId));positions.push(paginationFactor+positionCounter);positionCounter++}});return{ad_impressions:impressions,ad_positions:positions}}};$(document).trackNinja('ready',adImpressionsTracking);$(window).trackNinja('ajaxReady',adImpressionsTracking);var $listingPreview=$('article.listing-preview');if($listingPreview.length){var $listingPreviewAdId=$listingPreview.data('impression-ad-id')||null;$(document).trackNinja('ready',{params:{trackEvent:['ad_card_impression'],action_type:'ad_card_impression',event_type:'impression',touch_point_page:touchPointPage,ad_id:$listingPreviewAdId}});$listingPreview.trackNinja('click',{params:{trackEvent:['ad_card_click'],action_type:'ad_card_click',event_type:'click',touch_point_page:touchPointPage,ad_id:$listingPreviewAdId}})};new NinjaTracker('.contact-button:visible','mousedown',{params:{trackEvent:['reply_message_form_click'],action_type:'reply_message_form_click',event_type:'click',touch_point_page:touchPointPage,ad_id:null},onEvent:function(){var isInPreview=this.selector.parent().hasClass('in-preview');if(isInPreview)return{touch_point_button:'ad_preview_card'};return{}}});$('.quick-contact-form').trackNinja('submit',{params:{trackEvent:['reply_message_click'],action_type:'reply_message_click',event_type:'click',touch_point_page:touchPointPage,ad_id:null}});$('.quick-contact-form').trackNinja('submit',{params:{trackEvent:['reply_message_sent'],action_type:'reply_message_sent',event_type:'click',touch_point_page:touchPointPage,ad_id:null},validate:function(){return this.selector.valid()&&this.selector.find('.errorboxContainer label:visible').length===0}});new NinjaTracker('.contact-box .spoiler','mousedown',{params:{trackEvent:['reply_phone_show'],action_type:'reply_phone_show',event_type:'click',touch_point_page:touchPointPage,ad_id:null}});new NinjaTracker('.seller-logo a, a.offer-item__link-seller','click',{params:{trackEvent:['more_ads_from_seller'],action_type:'more_ads_from_seller',event_type:'click',touch_point_page:touchPointPage,touch_point_button:null,ad_id:null},onEvent:function(){var touchPointButton='text';if(this.selector.children('img').length>0)touchPointButton='image';return{touch_point_button:touchPointButton}}});new NinjaTracker('a[href^="tel:"]','click',{params:{trackEvent:['reply_phone_call'],action_type:'reply_phone_call',event_type:'click',touch_point_page:touchPointPage,ad_id:null,touch_point_button:null}})})(jQuery,window.NinjaTracker,ninjaPV||dataLayer[0]);(function(e){function t(t,n){function w(){r.update();S();return r}function E(){var e=d.toLowerCase();f.obj.css(p,v/u.ratio);o.obj.css(p,-v);g.start=f.obj.offset()[p];u.obj.css(e,a[n.axis]);a.obj.css(e,a[n.axis]);f.obj.css(e,f[n.axis])}function S(){if(!y){f.obj.bind("mousedown",x);a.obj.bind("mouseup",N);var e;l.obj.mousedown(function(){b.obj.addClass("noSelect");clearInterval(e);e=setInterval(C,50)}).mouseup(function(){b.obj.removeClass("noSelect");clearInterval(e)});c.obj.mousedown(function(){b.obj.addClass("noSelect");clearInterval(e);e=setInterval(k,50)}).mouseup(function(){b.obj.removeClass("noSelect");clearInterval(e)});l.obj.bind("click",function(){clearInterval(e);C();return false});c.obj.bind("click",function(){clearInterval(e);k();return false})}else{var e;f.obj[0].ontouchstart=function(e){if(1===e.touches.length){x(e.touches[0]);e.stopPropagation()}};l.obj.bind("touchstart",function(){b.obj.addClass("noSelect");clearInterval(e);e=setInterval(C,50)}).bind("touchend",function(){b.obj.removeClass("noSelect");clearInterval(e)});c.obj.bind("touchstart",function(){b.obj.addClass("noSelect");clearInterval(e);e=setInterval(k,50)}).bind("touchend",function(){b.obj.removeClass("noSelect");clearInterval(e)})}if(n.scroll&&window.addEventListener){i[0].addEventListener("DOMMouseScroll",T,false);i[0].addEventListener("mousewheel",T,false)}else if(n.scroll){i[0].onmousewheel=T}}function x(t){e("body").addClass("noSelect");var n=parseInt(f.obj.css(p),10);g.start=h?t.pageX:t.pageY;m.start=n=="auto"?0:n;if(!y){e(document).bind("mousemove",N);e(document).bind("mouseup",L);f.obj.bind("mouseup",L)}else{document.ontouchmove=function(e){e.preventDefault();N(e.touches[0])};document.ontouchend=L}}function T(t){if(o.ratio<1){var r=t||window.event,i=r.wheelDelta?r.wheelDelta/120:-r.detail/3;v-=i*n.wheel;v=Math.min(o[n.axis]-s[n.axis],Math.max(0,v));f.obj.css(p,v/u.ratio);o.obj.css(p,-v);if(n.lockscroll||v!==o[n.axis]-s[n.axis]&&v!==0){r=e.event.fix(r);r.preventDefault()}}}function N(e){if(o.ratio<1){if(n.invertscroll&&y){m.now=Math.min(a[n.axis]-f[n.axis],Math.max(0,m.start+(g.start-(h?e.pageX:e.pageY))))}else{m.now=Math.min(a[n.axis]-f[n.axis],Math.max(0,m.start+((h?e.pageX:e.pageY)-g.start)))}v=m.now*u.ratio;o.obj.css(p,-v);f.obj.css(p,m.now)}}function C(){o.ratio=s[n.axis]/o[n.axis];u.obj.toggleClass("disable",o.ratio>=1);if(v>10){v-=10}else{v=0}E()}function k(){o.ratio=s[n.axis]/o[n.axis];u.obj.toggleClass("disable",o.ratio>=1);iScrollBottom=o.ratio<=1?o[n.axis]-s[n.axis]:isNaN(parseInt(sScroll,10))?v:parseInt(sScroll,10);if(iScrollBottom-v>10){v+=10}else{v=iScrollBottom}E()}function L(){e("body").removeClass("noSelect");e(document).unbind("mousemove",N);e(document).unbind("mouseup",L);f.obj.unbind("mouseup",L);document.ontouchmove=document.ontouchend=null}var r=this,i=t,s={obj:e(".viewport",t)},o={obj:e(".overview",t)},u={obj:e(".scrollbar",t)},a={obj:e(".track",u.obj)},f={obj:e(".thumb",u.obj)},l={obj:e(".scrollbarup",u.obj)},c={obj:e(".scrollbardown",u.obj)},h=n.axis==="x",p=h?"left":"top",d=h?"Width":"Height",v=0,m={start:0,now:0},g={},y="ontouchstart"in document.documentElement,b={obj:e("body")};this.update=function(e){if(n.arrowsInside){u.obj.css("marginTop",18)}s[n.axis]=s.obj[0]["offset"+d]-(n.arrowsInside?36:0);o[n.axis]=o.obj[0]["scroll"+d]-(n.arrowsInside?36:0);o.ratio=s[n.axis]/o[n.axis];u.obj.toggleClass("disable",o.ratio>=1);a[n.axis]=n.size==="auto"?s[n.axis]:n.size;f[n.axis]=Math.min(a[n.axis],Math.max(0,n.sizethumb==="auto"?a[n.axis]*o.ratio:n.sizethumb));u.ratio=n.sizethumb==="auto"?o[n.axis]/a[n.axis]:(o[n.axis]-s[n.axis])/(a[n.axis]-f[n.axis]);v=e==="relative"&&o.ratio<=1?Math.min(o[n.axis]-s[n.axis],Math.max(0,v)):0;v=e==="bottom"&&o.ratio<=1?o[n.axis]-s[n.axis]:isNaN(parseInt(e,10))?v:parseInt(e,10);E()};return w()}e.tiny=e.tiny||{};e.tiny.scrollbar={options:{axis:"y",wheel:40,scroll:true,lockscroll:true,size:"auto",sizethumb:"auto",invertscroll:false,arrowsInside:false}};e.fn.tinyscrollbar=function(n){var r=e.extend({},e.tiny.scrollbar.options,n);this.each(function(){e(this).data("tsb",new t(e(this),r))});return this};e.fn.tinyscrollbar_update=function(t){return e(this).data("tsb").update(t)}})(jQuery);$(function(){new ModerationClass()});ModerationClass=BaseClass.extend({init:function(){var thiz=this;this._super();this.initModeration();this.ajaxContainer=$('#listContainer');thiz.ajaxContainer.ajaxComplete(function(){thiz.initModeration()})},initModeration:function(){var thiz=this,editbarDiv=$('.editbar');if(editbarDiv.data('inited'))return;editbarDiv.data('inited',true);var canEdit=$('#frontendEditBox').length;if($('.editbar #selectAllBtn').length>0)$('.rightBranding').hide();var $sliders=$('.editbar .slider');$sliders.click(function(){$('.editbar .box').slideUp();$sliders.find(".icon").removeClass('aeup').addClass('aedown');var buttonID=$(this).attr("id"),actionName=buttonID.substring(7,200).toLowerCase();if($('.editbar .box.'+actionName).is(":hidden")){$(this).find(".icon").removeClass('aedown').addClass('aeup');$('.editbar .box.'+actionName).slideDown()};return false});$('.editbar:first .cancel-edit').click(function(e){e.preventDefault();$sliders.find(".icon").removeClass('aeup').addClass('aedown');$('.editbar .box').slideUp()});if(typeof $.fn.renderForms=='function'){$('input[data-moderation-selection]').renderForms({dropdowns:false});$('#selectAllBtn').parent().renderForms({dropdowns:false})};$('.banselect').click(function(){$this=$(this);$('.banselect').removeClass('banselected');$this.addClass('banselected');return false});$('#removeAdButton').click(function(){$selected=$('.banselected');if($selected.size()==0){alert('Select ban reason');return false};var reasonId=$selected.data("banId"),offerId=$selected.data("offerId"),isPaid=false;if($(this).hasClass('is_paid'))isPaid=true;$('#ajax-remove-message').text('wait...').show();$.post(window.location.origin+'/adminpanel/ajax/frontendmoderation/remove/',{ids:offerId,reason:reasonId,paid_ads_remove:isPaid?1:0},function(data){$('#ajax-remove-message').text('Removed').show();setTimeout(function(){$('#ajax-remove-message').fadeOut(1e3);$('#ajax-remove-message').hide()},3e3)});return false});$('#removeAdsButton').click(function(){$selected=$('.banselected');if($selected.size()==0){alert('Select ban reason');return false};var reasonId=$selected.data("banId"),offerIds=[];$('input[data-moderation-selection]:checked').each(function(){offerIds.push($(this).val())});offerIds=offerIds.join(',');$('#ajax-remove-message').text('wait...').show();$.post(window.location.origin+'/adminpanel/ajax/frontendmoderation/remove/',{ids:offerIds,reason:reasonId},function(data){$('#ajax-remove-message').text('Removed').show();setTimeout(function(){$('#ajax-remove-message').fadeOut(1e3);$('#ajax-remove-message').hide()},3e3)});return false});var changeFn=function(){$('#saveEdit').attr('disabled',false).parent().removeClass('disabled')};$('#privateBusiness, .category-select, #offerSeek, #segmentField, #makeField, #modelField').change(changeFn);$('#title, #description').bind('keypress change keyup',changeFn);$('#saveEdit').click(function(){var offerId=$(this).data("offerId"),title=$('#title').val(),txt=$('textarea[name="description"]').val(),idCat=$('#category_field').val(),privateBusiness=$('#privateBusiness').val(),offerSeek=$('#offerSeek').val(),segment=$('#segmentField').val(),make=$('#makeField').val(),model=$('#modelField').val();$('#ajax-message').text('wait...').show();var postData={id:offerId,title:title,description:txt,id_category:idCat,private_business:privateBusiness,offer_seek:offerSeek,segment:segment,make:make,model:model},paramName=$('#fakecategory_name_field').val();if(paramName){postData.fakeCategoryParamName=paramName;postData.fakeCategoryParamValue=$('#fakecategory_value_field').val()};$.post(window.location.origin+'/adminpanel/ajax/frontendmoderation/edit/',postData,function(data){if(typeof data.status=='string'){$('#ajax-message').text('Saved').show();setTimeout(function(){$('#ajax-message').fadeOut(1e3);$('#ajax-message').hide()},3e3)}});return false});$('#multiEdit').click(function(){var offerIds=[];$('input[data-moderation-selection]:checked').each(function(){offerIds.push($(this).val())});var idCat=$('#category_field').val(),privateBusiness=$('#privateBusiness').val(),offerSeek=$('#offerSeek').val();$('#ajax-message').text('wait...').show();var postData={ids:offerIds,id_category:idCat,private_business:privateBusiness,offer_seek:offerSeek,segment:$('#segmentField').val()},paramName=$('#fakecategory_name_field').val();if(paramName){postData.fakeCategoryParamName=paramName;postData.fakeCategoryParamValue=$('#fakecategory_value_field').val()};$.post(window.location.origin+'/adminpanel/ajax/frontendmoderation/multiedit/',postData,function(data){if(typeof data.status=='string'){$('#ajax-message').text('Saved').show();setTimeout(function(){$('#ajax-message').fadeOut(1e3);$('#ajax-message').hide()},3e3)}});return false});$('.category-select').change(function(){$this=$(this);var idCat=$this.find('option:selected').val();thiz.showCategory(idCat);$('option[parent='+idCat+']').parent().show();newSelected=$('option[parent='+idCat+']').parent().find(':first').val();if($('#edit-cat-'+newSelected).attr('is_last')=='1')$('#category_field').val(newSelected)});var $allParamSelect=$('.param-select').change(function(){$this=$(this);var paramName=$this.data('name'),paramValue=$this.val();$('#fakecategory_name_field').val(paramName);$('#fakecategory_value_field').val(paramValue)});if(canEdit&&window.hotkeys)$(document).keydown(function(e){if(e.altKey){var keyCode=String.fromCharCode((96<=e.keyCode&&e.keyCode<=105)?e.keyCode-48:e.keyCode).toLowerCase();for(var i=0;i<hotkeys.length;i++)if(keyCode===hotkeys[i].key){thiz.showCategory(hotkeys[i].category_id);var adID=$('#saveEdit').data("offerId");$.get(window.location.origin+'/adminpanel/ajax/frontendmoderation/changecategory/',{adID:adID,categoryID:hotkeys[i].category_id},function(){alert('Category was changed.')});break};return false}});if(canEdit){if(typeof __moderation_category_id!='undefined')thiz.showCategory(__moderation_category_id);if(typeof __moderation_fakecategory_value!="undefined")$('#fake_category_'+__moderation_category_id).val(__moderation_fakecategory_value).change();var firstCategory=$('.category-select [is_last=1]').val();$('#checkbox-change-category').bind('click',function(){var $this=$(this);if($this.filter(':checked').length){thiz.showCategory(firstCategory)}else{$('.category-select').hide();$('#category_field').val('')}})};$allParamSelect.change(changeFn);$('.removeImage').click(function(){var $this=$(this),adID=$('#saveEdit').data("offerId");$this.closest('li').remove();$.post(window.location.origin+'/adminpanel/ajax/frontendmoderation/removeimage/',{adID:adID,number:$this.attr('rel'),async:true});return false});$('#cancelDelete').click(function(){$('#editbarDeletearchived').click()});$('#editbarDeletearchived').click(function(){$('#saveDelete').click()});$('#saveDelete').click(function(){var offerId=$(this).data("offerId");$('#ajax-delete-message').text('wait...').show();$.post(window.location.origin+'/adminpanel/ajax/moderation/deletearchived/',{id:offerId},function(data){if(typeof data.status=='string'){$('#ajax-delete-message').text('Deleted').show();setTimeout(function(){$('#ajax-delete-message').fadeOut(1e3);$('#ajax-delete-message').hide()},3e3)}});return false});$('#addComment').click(function(){var $txt=$('#rmoderation_comment');text=$txt.val(),userID=$txt.data("userId");$.post(window.location.origin+'/adminpanel/ajax/moderation/usercomment/',{userID:userID,text:text},function(data){$txt.val('');var $tpl=$('#userCommentTemplate').clone().removeAttr('id');data.content=text;for(var v in data)$tpl.find('#'+v).text(data[v]).removeAttr('id');$tpl.hide().appendTo($('.commentslist')).fadeIn('slow');$('.commentslist').scrollTop(999999)},'json');return false});$('#selectAllBtn').click(function(){var $checkbox=$(this).parent().find(':checkbox');if($checkbox.is(':checked')){$('input[data-moderation-selection]').attr('checked',true).change()}else $('input[data-moderation-selection]').attr('checked',false).change()});var $adsCheckboxes=$('input[data-moderation-selection]');$adsCheckboxes.click(function(){var $btn=$('#selectAllBtn');if($btn.is(':checked')&&$adsCheckboxes.length>$adsCheckboxes.filter(':checked').length)$('#selectAllBtn').attr('checked',false).change();if($btn.is(':not(:checked)')&&$adsCheckboxes.length==$adsCheckboxes.filter(':checked').length)$('#selectAllBtn').attr('checked',true).change()});$('select.make-select').change(function(){var $this=$(this),modelSelect=$('.model-select'),idMake=$this.find('option:selected').val();modelSelect.find('option').hide();modelSelect.val([]);modelSelect.find('option[data-make='+idMake+']').show()});if($('select.make-select').find('option:selected').val()){var makeSelect=$('select.make-select'),modelSelect=$('select.model-select'),idMake=makeSelect.find('option:selected').val();modelSelect.find('option').hide();modelSelect.find('option[data-make='+idMake+']').show()}},showCategory:function(categoryId){var thiz=this;$('.category-select').hide();$('.category-select').find('option').removeAttr('selected');var __categoryId=categoryId;do{obj=$('#edit-cat-'+categoryId);obj.parent().show();obj.attr('selected','selected');categoryId=obj.attr('parent')}while(categoryId);$('#category_field').val('');if($('#edit-cat-'+__categoryId).attr('is_last')=='1'){$('#category_field').val(__categoryId);thiz.showFakeCategory(__categoryId)}else thiz.showCategory($('.category-select option[parent='+__categoryId+']').attr('value'))},showFakeCategory:function(categoryId){$('.param-select').hide();$('#fakecategory_name_field').val('');$('#fakecategory_value_field').val('');var $el=$('#fake_category_'+categoryId).show();if($el.length){$el.val($el.children(':first').attr('value'));$el.change()}}});AdsenseClassBase=Class.extend({adsBlocks:[],init:function(options){var thiz=this;thiz.w=document.write;thiz.options=$.extend({},options)},setQuery:function(query){this.query=query},setRegionName:function(regionName){this.regionName=regionName},setSubregionName:function(subRegionName){this.subRegionName=subRegionName},setCategory:function(id,name,code,adsenseText){this.category={id:id,name:name,code:code,adsenseText:adsenseText}},setRootCategory:function(id,name,code){this.rootCategory={id:id,name:name,code:code}},setSeoPageName:function(seoPageName){this.seoPageName=seoPageName},getChannel:function(channelCode){var thiz=this,channelsCodes=thiz.getChannelsCodes();if(window.isUserSearch)return channelsCodes.user_search;var mapping=thiz.getCategoryChannelsMapping(),channels=thiz.rootCategory&&thiz.rootCategory.id?mapping[thiz.rootCategory.id]:false;if(!channels)return channelsCodes[channelCode];if(thiz.query){return channelsCodes[channelCode]+(channels.asf?','+channels.asf:'')}else if(thiz.forAd){return channelsCodes[channelCode]+(channels.category?','+channels.category:'')+(channels.ad&&channels.ad!=channels.category?','+channels.ad:'')}else return channelsCodes[channelCode]+(channels.category?','+channels.category:'')+(channels.listing&&channels.listing!=channels.category?','+channels.listing:'')},addAdsenseForSearchBlock:function(container,numberOfAds,options){if(!$('#'+container).length)return;var thiz=this;options=$.extend({container:container,number:numberOfAds,lines:numberOfAds,fontFamily:'arial',fontSizeTitle:'16px',fontSizeDescription:'13px',fontSizeDomainLink:'13px',colorTitleLink:'#168ECA',colorText:'#B4B4B4',colorDomainLink:'#909090',attributionText:' ',longerHeadlines:true},options);thiz.adsBlocks.push(options)},showAdsenseForSearchAds:function(channelCode){var thiz=this,pageOptions={pubId:thiz.getPubId(),query:thiz.query+(thiz.regionName?(' '+thiz.regionName):''),channel:thiz.getChannel(channelCode),hl:thiz.getLanguageId(),linkTarget:'_blank',titleBold:false,LinkUnderline:false,rolloverLinkUnderline:true,rolloverLinkBackgroundColor:'#3074B9',rolloverLinkColor:'#FFFFFF',siteLinks:false,verticalSpacing:12};switch(thiz.adsBlocks.length){case 1:_googCsa('ads',pageOptions,thiz.adsBlocks[0]);break;case 2:_googCsa('ads',pageOptions,thiz.adsBlocks[0],thiz.adsBlocks[1]);break;case 3:_googCsa('ads',pageOptions,thiz.adsBlocks[0],thiz.adsBlocks[1],thiz.adsBlocks[2]);break};thiz.adsBlocks=[]},addAdsenseForContentBlock:function(container,numberOfAds,channelCode,options){if(!$('#'+container).length)return;var thiz=this;options=$.extend({container:container,google_max_num_ads:numberOfAds,google_adnum:0,google_skip:0,google_ad_client:thiz.getPubId(),google_ad_channel:thiz.getChannel(channelCode),google_ad_output:'js',google_ad_type:'text',google_feedback:'on',google_language:thiz.getLanguageId()},options);if(thiz.category&&thiz.category.adsenseText){options.google_kw_type='broad';options.google_kw=thiz.category.adsenseText}else options.google_hints=(thiz.category&&thiz.category.id&&thiz.seoPageName?thiz.seoPageName:thiz.getDefaultHint())+(thiz.subRegionName?(' '+thiz.subRegionName):'');thiz.adsBlocks.push(options)},showAdsenseForContentAds:function(){var thiz=this;if(typeof GoogleObj=='undefined'||!thiz.adsBlocks.length)return;thiz.googleAdsDetails=[];for(x in thiz.adsBlocks){var container=thiz.adsBlocks[x]['container'],data=thiz.adsBlocks[x];delete data.container;thiz.googleAdsDetails.push({data:data,callbackFunction:thiz.getGoogleAdsCallbackFunc(container)})};thiz.adsIndexToLoad=0;thiz.loadGoogleAds(thiz.googleAdsDetails[0])},loadGoogleAds:function(data){var variables=data.data;for(name in window)if(name.indexOf('google_')>=0)delete window[name];variables.google_adnum=0;variables.google_skip=0;window.google_ad_request_done=data.callbackFunction;for(v in variables)window[v]=variables[v];var eleScript=document.createElement('script');document.write=(function(params){$(document.body).append(params)});eleScript.setAttribute('type','text/javascript');eleScript.setAttribute('src','http://pagead2.googlesyndication.com/pagead/show_ads.js?'+(new Date().getTime()));$(document.body).append(eleScript)},loadGoogleNextAd:function(){var thiz=this;thiz.adsIndexToLoad++;if(typeof thiz.googleAdsDetails[thiz.adsIndexToLoad]!='undefined'){thiz.loadGoogleAds(thiz.googleAdsDetails[thiz.adsIndexToLoad])}else{document.write=thiz.w;thiz.adsBlocks=[]}},getGoogleAdsCallbackFunc:function(container){var $container=$('#'+container);if(!$container.length)return;var thiz=this;return function(google_ads){if(google_ads.length==0)return;var s='',i;if(google_ads[0].type=='flash'){s+='<a href=\"'+google_info.feedback_url+'\" style="color:000000">Linki sponsorowane</a><br><object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" codebase="http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=6,0,0,0" WIDTH="'+google_ad.image_width+'" HEIGHT="'+google_ad.image_height+'"> <PARAM NAME="movie" VALUE="'+google_ad.image_url+'"><PARAM NAME="quality" VALUE="high"><PARAM NAME="AllowScriptAccess" VALUE="never"><EMBED src="'+google_ad.image_url+'" WIDTH="'+google_ad.image_width+'" HEIGHT="'+google_ad.image_height+'" TYPE="application/x-shockwave-flash" AllowScriptAccess="never"  PLUGINSPAGE="http://www.macromedia.com/go/getflashplayer"></EMBED></OBJECT>'}else if(google_ads[0].type=='image'){s+='<a href=\"'+google_info.feedback_url+'\" style="color:000000"></a><br> <a href="'+google_ads[0].url+'" target="_top" title="Idź do '+google_ads[0].visible_url+'" onmouseout="window.status=\'\'" onmouseover="window.status=\'Przejdź do '+google_ads[0].visible_url+'\';return true"><img border="0" src="'+google_ads[0].image_url+'"width="'+google_ads[0].image_width+'"height="'+google_ads[0].image_height+'"></a>'}else if(google_ads[0].type=="html"){s+=google_ads[0].snippet}else if(google_ads.length>=1){for(i=0;i<google_ads.length;++i)s+='<div class="offer"><table cellspacing="0" cellpadding="0" width="100%" summary="Ogłoszenie" class="fixed breakword"><tbody><tr><td width="85" class="tcenter"><a class="color-11" href="'+google_info.feedback_url+'" target="_blank">Reklama</a></td><td width="120"><a href="'+google_ads[i].url+'" target="_blank" class="br-1 block" style="width:96px; height:78px"></a></td><td><h4 class="large lheight20"><a target="_blank" class="link adsense" href="'+google_ads[i].url+'" onmouseout="window.status=\'\'" onmouseover="window.status=\''+google_ads[i].visible_url+'\';return true"> <span> '+google_ads[i].line1+'</span></a> </h4><p class="small"><span>'+google_ads[i].line2+' '+google_ads[i].line3+'</span></p> <p class="small"><a target="_blank" class="c41 tunder" href="'+google_ads[i].url+'" onmouseout="window.status=\'\'" onmouseover="window.status=\''+google_ads[i].visible_url+'\';return true"><span>'+google_ads[i].visible_url+'</span></a></p></td><td width="1" class="wwnormal tright"></td><td width="1" class="tright small"></td></tr></tbody></table></div>';if(google_ads[0].bidtype=="CPC")google_adnum=google_adnum+google_ads.length};$container.html(s);thiz.loadGoogleNextAd();return}}});AdsenseClass=AdsenseClassBase.extend({getPubId:function(){return'pub-6308312097313755'},getLanguageId:function(){return'pl'},getCategoryChannelsMapping:function(){return{}},getChannelsCodes:function(){return{noresults:'2105807221'}}});var StickyElements=(function($){var settings={$target:null,elementHeight:0,elementTop:0,momentToStick:'hit',stickyClass:'is-stuck',spacerClass:'sticky-spacer',throttleInterval:40,top:0,unstickReference:null,baselineWhenUnstick:false}
function init(options){settings=$.extend({},settings,options);settings.$target=$(options.targetSelector);if(!settings.$target.length){window.console.log("StickyElements:","$target "+options.targetSelector+" 'not found'");return};updateLimits();bindEvents();stickOrUnstick()}
function bindEvents(){$(window).on('scroll',stickOrUnstick.throttle(settings.throttleInterval));$(window).on('orientationchange',updateLimits)}
function getScrollPosition(){return $(document).scrollTop()}
function stickOrUnstick(){if(settings.elementHeight<30)settings.elementHeight=+settings.$target.outerHeight();if(settings.elementHeight<20)return false;if(settings.unstickReference&&!$(settings.unstickReference).length){console.log("Missing "+settings.unstickReference+". Cannot add stick behavior");return false};if(settings.momentToStick=="hide"){if(hasExceededMin("hide")){stick()}else unstick()}else if(hasExceededMin()&&!hasExceededMax()){stick()}else{unstick();if(settings.baselineWhenUnstick&&settings.unstickReference&&hasExceededMax())alignToBaseline()}}
function hasExceededMin(type){return getScrollPosition()+settings.top>=settings.elementTop+(type=="hide"?settings.elementHeight:0)}
function hasExceededMax(){return getScrollPosition()+settings.top+settings.elementHeight>=$(settings.unstickReference).offset().top}
function stick(){var viewportHeight=Math.max(document.documentElement.clientHeight,window.innerHeight||0),isSmallViewport=settings.elementHeight>=viewportHeight-settings.top,stylesForSticky={bottom:isSmallViewport?'0':'auto',position:'fixed',top:!isSmallViewport?settings.top+'px':'auto',zIndex:1};settings.$target.css(stylesForSticky);addSpacer();settings.$target.addClass(settings.stickyClass)}
function unstick(){$("."+settings.spacerClass).remove();settings.$target.removeClass(settings.stickyClass);settings.$target.removeClass(settings.stickyClass+"-at-baseline");settings.$target.removeAttr("style")}
function addSpacer(){if($("."+settings.spacerClass).length)return;var $spacer=$("<div class='"+settings.spacerClass+"'></div>");$spacer.css({height:settings.elementHeight+'px',order:1,width:'100%'});settings.$target.after($spacer)}
function updateLimits(){settings.elementTop=+settings.$target.offset().top;settings.elementHeight=+settings.$target.outerHeight()}
function alignToBaseline(){settings.$target.css({bottom:0,position:'absolute',top:'auto'});settings.$target.addClass(settings.stickyClass+"-at-baseline")};return{init:init,updateLimits:updateLimits}})(jQuery);Function.prototype.debounce=function(milliseconds){var baseFunction=this,timer=null,wait=milliseconds;return function(){var self=this,args=arguments
function complete(){baseFunction.apply(self,args);timer=null};if(timer)clearTimeout(timer);timer=setTimeout(complete,wait)}};Function.prototype.throttle=function(milliseconds){var baseFunction=this,lastEventTimestamp=null,limit=milliseconds;return function(){var self=this,args=arguments,now=Date.now();if(!lastEventTimestamp||now-lastEventTimestamp>=limit){lastEventTimestamp=now;baseFunction.apply(self,args)}}};var Events=(function(){var EVENT_GROUPS={ADS:'ads',DEALERS:'dealers'},EVENT_TYPES={VIEW_HOME:'view_home',VIEW_SIMILAR:'view_similar',VIEW_RESULTS:'view_results',VIEW_DEALER_PAGE:'view_dealer_page',VIEW_AD_PAGE:'view_ad_page',VIEW_SHOW_MAP:'show_map',VIEW_SHOW_FAV:'show_fav',SMS:'sms',MESSAGE:'message',PHONE_CLICKS:'phone_clicks',PHONE_CALLS:'phone_calls'},itemIds=[]
function addItemId(itemId){if(itemIds.indexOf(itemId)==-1)itemIds.push(itemId)}
function setItemIds(newItemIds){itemIds=newItemIds}
function isRwdFromBackend(){return xtcustom.platform=='i2'}
function log(eventGroup,eventType,callback){var source=null,protectionTokenNumber=1<<2;if(isRwdFromBackend()){source='rwd'}else source='desktop';var xhr=new XMLHttpRequest();if(window.XMLHttpRequest){xhr=new XMLHttpRequest()}else xhr=new ActiveXObject('Microsoft.XMLHTTP');var queryString='';queryString+='eventGroup='+eventGroup;queryString+='&eventType='+eventType;queryString+='&source='+source;queryString+='&protectionTokenNumber='+protectionTokenNumber;itemIds.forEach(function(itemId){queryString+='&itemIds[]='+itemId});xhr.open('POST',www_base_ajax+'/logevent/',true);xhr.setRequestHeader('Content-Type','application/x-www-form-urlencoded');xhr.onload=function(){if(callback)callback()};xhr.send(queryString)}
function logDetected(detected){var protectionTokenNumber=1<<2,xhr=new XMLHttpRequest();if(window.XMLHttpRequest){xhr=new XMLHttpRequest()}else xhr=new ActiveXObject('Microsoft.XMLHTTP');var queryString='';queryString+='protectionTokenNumber='+protectionTokenNumber;queryString+='&detected='+detected;xhr.open('POST',www_base_ajax+'/logevent/detected/',true);xhr.setRequestHeader('Content-Type','application/x-www-form-urlencoded');xhr.send(queryString)}
function resetItemIds(){itemIds=[]};return{log:log,addItemId:addItemId,setItemIds:setItemIds,resetItemIds:resetItemIds,EVENT_GROUPS:EVENT_GROUPS,EVENT_TYPES:EVENT_TYPES,logDetected:logDetected,isRwdFromBackend:isRwdFromBackend}})();var AdsEvents=(function($){var $adResults=$('div.offer-item__content a[data-ad-id]'),adResultIds=[]
function init(){$(window).on('scroll load',function(){$adResults.each(function(){if(inViewport(this)){var adId=$(this).data('ad-id');if(adResultIds.indexOf(adId)==-1)adResultIds.push(adId)}})}.throttle(2e3));window.onbeforeunload=logAdResults}
function logAdResults(){if(adResultIds.length==0)return;Events.resetItemIds();Events.setItemIds(adResultIds);Events.log(Events.EVENT_GROUPS.ADS,Events.EVENT_TYPES.VIEW_RESULTS)}
function logFavorites(adId){Events.resetItemIds();Events.addItemId(adId);Events.log(Events.EVENT_GROUPS.ADS,Events.EVENT_TYPES.VIEW_SHOW_FAV)}
function inViewport(element){var viewport={top:$(window).scrollTop()},bounds=$(element).offset();viewport.bottom=viewport.top+$(window).height();bounds.bottom=bounds.top+$(element).outerHeight();return(!(viewport.bottom<bounds.top||viewport.top>bounds.bottom))};return{init:init,logAdResults:logAdResults,logFavorites:logFavorites}})(jQuery);$(function(){ads=new AdsClass()});